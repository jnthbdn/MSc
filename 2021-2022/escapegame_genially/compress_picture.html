<div id="grid-container" style="width: 100%; height: 100%;">
</div>
<div id="overlay" style="width: 100%; height: 100%; background-color: #00000080; z-index: 9999999; display: none; position: absolute; top: 0; left: 0;">
</div>

<script>
    class CompressImage{

        static UNCHECK_COLOR = "white";
        static CHECK_COLOR = "black";
        
        
        constructor(container_id){
            
            this.grid_size = 5;
            this.results = [
                [2, 3],
                [1, 4],
                [2,1, 1, 1],
                [0, 3],
                [1, 1, 1, 1]
            ];


            this.create_grid(container_id);
        }


        create_grid(parentID){

            let table = document.createElement("table");
            let linesInfos = this.generate_infos();
            let container = document.getElementById(parentID);
            let pixelSize = Math.floor( Math.min( container.clientWidth / (this.grid_size+1.5), container.clientHeight / this.grid_size ) );
            
            container.innerHTML = "";
            container.append(table)
            table.style.cssText = "border-collapse: collapse; max-width: 100%; max-height: 100%;";

            for( let y = 0; y < this.grid_size; ++y ){
                let tr = document.createElement("tr");
                table.append(tr);

                for( let x = 0; x < this.grid_size; ++x ){
                    let td = document.createElement("td");
                    tr.append(td);
                    td.id = `cell_${x}_${y}`;
                    td.style.cssText = `width: ${pixelSize}px; height: ${pixelSize}px; border: 1px solid black; background-color: ${CompressImage.UNCHECK_COLOR};`;
                    td.addEventListener('click', ev => this.toggle_cell_color(td) );
                }

                let info = document.createElement("td");
                tr.append(info);
                info.style.cssText = `width: ${pixelSize*1.5}px; overflow: hidden; height: ${pixelSize}px; border: 1px solid black; font-size: ${pixelSize/2}px`;
                info.innerHTML = linesInfos[y];
            }
        }

        toggle_cell_color(cell){
            cell.style.backgroundColor = cell.style.backgroundColor == CompressImage.UNCHECK_COLOR ? CompressImage.CHECK_COLOR : CompressImage.UNCHECK_COLOR;
            this.check_grid();
        }

        check_grid(){
            let line = [];
            let isPreviousUncheck = true;

            for( let y = 0; y < this.grid_size; ++y ){
                line = [0];
                isPreviousUncheck = true;

                for( let x = 0; x < this.grid_size; ++x ){
                    let cellColor = document.getElementById(`cell_${x}_${y}`).style.backgroundColor;

                    if( cellColor == CompressImage.UNCHECK_COLOR ){
                        if( isPreviousUncheck ){
                            line[line.length - 1]++;
                        }
                        else{
                            line.push(1);
                            isPreviousUncheck = true;
                        }
                    }
                    else{
                        if( isPreviousUncheck ){
                            line.push(1);
                            isPreviousUncheck = false;
                        }
                        else{
                            line[line.length - 1]++;
                        }
                    }
                }

                if( isPreviousUncheck && line.length > 1 ){
                    line.splice(-1, 1); //Remove last white count
                }

                if( !this.isArraysEquals(line, this.results[y]) ){
                    return;
                }
            }

            document.getElementById("overlay").style.display = "block";
            alert("You won !");
        }

        isArraysEquals(a, b){
            return JSON.stringify(a) === JSON.stringify(b);
        }

        generate_infos(){
            let infos= [];

            this.results.forEach(line => {
                let infoLine = "";
                let isUncheck = true;

                line.forEach( nb => {
                    infoLine += `<span style="border: 1px solid black;`;

                    if( isUncheck ){
                        infoLine += `background-color: ${CompressImage.UNCHECK_COLOR}; color: ${CompressImage.CHECK_COLOR};">`;
                    }
                    else{
                        infoLine += `background-color: ${CompressImage.CHECK_COLOR}; color: ${CompressImage.UNCHECK_COLOR};">`;
                    }

                    infoLine += `${nb}</span>`
                    isUncheck = !isUncheck;
                });

                infos.push(infoLine);
            });

            return infos;
        }
    };

    var grid = new CompressImage("grid-container");


</script>