<div id="container" style="width: 100%; height: 100%;">
</div>
<div id="overlay" style="width: 100%; height: 100%; background-color: #00000080; z-index: 9999999; display: none; position: absolute; top: 0; left: 0;">
</div>

<style>
    #chessboard tr td, #chessboard tr th {
        padding: 0;
        margin: 0;
        vertical-align: middle;
        text-align: center;
        position: relative;
    }

    #chessboard div.takeAllPlace, #chessboard .selection {
        width: 100%;
        height: 100%;
        position: absolute;
        top: 0;
        left: 0;
    }

    #chessboard .selection {
        background: radial-gradient(circle, rgba(255,255,255,0) 40%, rgba(50, 50, 255, 1) 100%);
    }

    #chessboard div.centerMe {
        position: relative;
        top: 50%;
        transform: translate(0, -50%);
    }
</style>

<script>

    class Mat1Coup {
        static BLACK_CELL = "#AAAAAA";
        static WHITE_CELL = "#FFFFFF";
        static BLACK_CELL_HOVER = "#222255";
        static WHITE_CELL_HOVER = "#AAAAFF";
        static INFOS_CELL = "#FFFFFF";

        static WHITE_PIECES = { "K": "&#9812;", "Q": "&#9813;", "R": "&#9814;", "B": "&#9815;", "N": "&#9816;", "P": "&#9817;" };
        static BLACK_PIECES = { "K": "&#9818;", "Q": "&#9819;", "R": "&#9820;", "B": "&#9821;", "N": "&#9822;", "P": "&#9823;" };

        constructor(elementID, positions, result){
            let container = document.getElementById(elementID);
            let cellSize = Math.floor( Math.min( container.clientHeight, container.clientWidth ) / 9 );

            this.createGrid( elementID, cellSize );
            this.placePieces(positions);

            this.selectCell = null;
            this.result = result;
            this.container = container;
        }

        createGrid(elementID, cellSize){

            let halfCellSize = Math.floor( cellSize / 2);
            let table = document.createElement("table")
            
            table.style.cssText = "border-collapse: collapse; text-align: center;";
            table.id = "chessboard";


            this.crearteGridLetter(table, cellSize);

            for( let y = 8; y > 0; --y ){
                let tr = document.createElement("tr");

                for( let x = 0; x < 10; ++x ){

                    let td = document.createElement("td");

                    if( x == 0 || x == 9 ){
                        td.style.cssText = `width: ${halfCellSize}px; height: ${cellSize}px; border: 1px solid black; background-color: ${Mat1Coup.INFOS_CELL}; font-size: ${halfCellSize-5}px;"`;
                        td.innerHTML = `<div class="takeAllPlace"><div class="centerMe">${y}</div></div>`;
                    }
                    else{
                        td.style.cssText = `cursor: pointer; width: ${cellSize}px; height: ${cellSize}px; border: 1px solid black; background-color: ${ ((x+y) % 2 == 0) ? Mat1Coup.WHITE_CELL : Mat1Coup.BLACK_CELL};  font-size: ${cellSize-11}px;`;
                        td.id = `${this.columnIndexToChar(x-1)}${y}`;
                        td.addEventListener("click", (e) => this.onClickCell(td, x, y) );
                    }

                    tr.append(td);
                }

                table.append(tr);
            }

            this.crearteGridLetter(table, cellSize);


            document.getElementById(elementID).innerHTML = "";
            document.getElementById(elementID).append(table);
        }

        crearteGridLetter(table, cellSize){
            let tr = document.createElement("tr");
            let halfCellSize = Math.floor( cellSize / 2);

            for( let i = 0; i < 10; ++i ){
                let td = document.createElement("td");

                if( i == 0 || i == 9 ) {
                    td.style.cssText = `"width: ${halfCellSize}px; height: ${halfCellSize}px;"`;
                }
                else {
                    td.style.cssText = `width: ${cellSize}px; height: ${halfCellSize}px; font-size: ${halfCellSize-5}px; border: 1px solid black; background-color: ${Mat1Coup.INFOS_CELL};"`;
                    td.innerText = this.columnIndexToChar(i-1);
                }

                tr.append(td);
            }

            table.append(tr);
        }

        columnIndexToChar(index){
            return String.fromCharCode( "A".charCodeAt(0) + index );
        }

        onClickCell(element, x, y){

            if( this.selectCell == null ){
                this.selectCell = element;
                this.applySelectStyle();
            }
            else if( this.selectCell.id == element.id ){
                this.removeSelectStyle();
                this.selectCell = null;
            }
            else{
                if( this.result.from == this.selectCell.id && this.result.to == element.id ){
                    console.log("Yeah !!");
                }
                else{
                    console.log("Fail...");
                }   

                this.removeSelectStyle();
                this.selectCell = null;
            }
        }

        applySelectStyle(){
            let div = document.createElement("div");
            div.classList.add("selection");

            this.selectCell.append(div);
        }

        removeSelectStyle(){
            Array.from( document.getElementsByClassName("selection") ).forEach( (e) => e.remove() );
        }

        placePieces(positions){
            ["white", "black"].forEach( color => {
                Object.keys(positions[color]).forEach( (p) => {

                    document.getElementById(positions[color][p]).innerHTML = `<div class="takeAllPlace">${color == "white" ? Mat1Coup.WHITE_PIECES[p] : Mat1Coup.BLACK_PIECES[p] }</div>`;

                });
            });
        }

        destroy(){
            this.container.innerHTML = "";
        }

    }

    var start_position = {
            black:{
                K: "G7",
                R: "H8",
                B: "F8"
            },
            white:{
                K: "G2",
                Q: "H5",
                P: "F5"
            }
        };

    var result = {
        from: "H5",
        to: "G6"
    }

    var mat = new Mat1Coup("container", start_position, result);

</script>